using System.Reflection;

namespace MbThreatTracker.Services
{
    public class MalwarebytesService
    {
        private static readonly string _programFilesPath = Environment.ExpandEnvironmentVariables("%ProgramW6432%");

        public static string? GetDatabasePassword()
        {
            string mbPath = Path.Combine(_programFilesPath, "Malwarebytes\\Anti-Malware");

            var mbamuiPath = Path.Combine(mbPath, "MbamUI.Data.dll");
            var assembly = Assembly.LoadFrom(mbamuiPath);

            var type = assembly.GetType("MbamUI.Data.AppDbContextFactory");
            var field = type?.GetField("PassPhrase", BindingFlags.Public | BindingFlags.Static);

            return field?.GetValue(null) as string;
        }
    }
}
